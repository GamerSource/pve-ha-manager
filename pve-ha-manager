#!/usr/bin/perl 

use lib ('.', '..');

use strict;
use warnings;
use Getopt::Long;
use JSON; 

use PVE::Tools;
use PVE::HA::SimCluster;

my $testdir;

if (!GetOptions ("test=s"   => \$testdir)) {
    print "usage: $0 [--test=<dir>]\n";
    exit -1;
}

if ($testdir) {

    my $filename = "$testdir/cluster_status";

    my $raw = PVE::Tools::file_get_contents($filename);
    my $cstatus = decode_json($raw);

    my $cluster = PVE::HA::SimCluster->new($testdir);

    $cluster->log('err', "starting simulation");

    eval { $cluster->run(); };
    if (my $err = $@) {
	$cluster->log('err', "exit simulation - $err ");
    } else {
	$cluster->log('info', "exit simulation - done");
    }

    exit(0);
   
} else {
    # my $statusdir; = "/var/tmp/pve-ha-manager";
    die "implement me";
}



